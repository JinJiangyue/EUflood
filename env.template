# ============================================
# 统一配置文件模板 - 根目录 .env
# ============================================
# 使用方法：
# 1. 复制此文件为根目录下的 .env
# 2. 填写你的实际 API Key 和配置值
# 3. 此文件包含 Node.js API 和 Python Search 模块的所有配置
# 4. 不要将 .env 文件提交到版本控制系统
# ============================================

# ---------------------- Node.js API 基础配置 ----------------------
NODE_ENV=development
LOG_LEVEL=info
PORT=3000
ENABLE_TRIGGER=true

# ---------------------- Node.js API 数据库配置 ----------------------
# 数据库类型：'sqlite' 或 'pocketbase'
# 默认使用 SQLite
DB_TYPE=sqlite

# SQLite 配置（当 DB_TYPE=sqlite 时使用）
# SQLite 数据库文件路径（相对于项目根目录）
# 新位置：apps/database/dev.db
DB_FILE=apps/database/dev.db

# PocketBase 配置
# PocketBase 服务器地址（例如：https://your-instance.pockethost.io 或 http://localhost:8090）
# 注意：如果 URL 不包含协议，会自动添加 https://
POCKETBASE_URL=flood.jinloveli.tech
# PocketBase 管理员邮箱（用于认证和管理操作）
POCKETBASE_ADMIN_EMAIL=your_admin_email@example.com
# PocketBase 管理员密码（用于认证和管理操作）
POCKETBASE_ADMIN_PASSWORD=your_admin_password
# PocketBase 管理员 Token（可选，如果提供了 token，将优先使用 token 认证）
# POCKETBASE_ADMIN_TOKEN=your_admin_token_here

# ---------------------- Node.js API Python 配置 ----------------------
# Python 解释器路径（可选，系统会自动检测嵌入式 Python）
# 如果从项目根目录运行，使用相对路径：apps/api/python-embed/python.exe
# PYTHON_PATH=apps/api/python-embed/python.exe
PYTHON_TIMEOUT=30000
# Python 脚本目录（相对于项目根目录）
# 新位置：apps/api/scripts
PYTHON_SCRIPT_DIR=apps/api/scripts
# 上传文件目录（相对于项目根目录）
# 降雨数据文件上传位置
UPLOAD_DIR=apps/uploads/rain_file
# 地理数据文件目录（相对于项目根目录）
# NUTS3 GeoJSON 文件在: apps/uploads/geofile/nuts3/
# City GPKG 文件在: apps/uploads/geofile/city/
GEO_FILE_DIR=apps/uploads/geofile
# 处理结果输出目录（相对于项目根目录）
OUTPUT_DIR=apps/api/outputs

# ---------------------- Python Search 模块配置 ----------------------
# 基础运行参数
ENV=development
# LOG_LEVEL 已在上面定义（Node.js API 使用）

# ---------------------- 数据库配置（可选，有默认值） ------------------------
# 以下配置都有默认值，通常不需要修改
# 只有在以下情况才需要配置：
# 1. 使用 MySQL/PostgreSQL 而不是 SQLite
# 2. 表名或列名与默认值不同
# 
# 默认值（在 search/config/settings.py 中定义）：
# DB_DIALECT=sqlite
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_USER=search_user
# DB_PASSWORD=search_password
# DB_NAME=search_service
# DB_CHARSET=utf8mb4
# RAIN_EVENTS_TABLE=rain_event
# REPORT_REGISTRY_TABLE=rain_reports
# EVENT_TIME_COLUMN=date
# LOCATION_COLUMN=city
# COUNTRY_COLUMN=country
# LATITUDE_COLUMN=latitude
# LONGITUDE_COLUMN=longitude
# RAINFALL_COLUMN=value
# SEVERITY_COLUMN=severity_level
# DATA_SOURCE_COLUMN=file_name
# PROCESSED_FLAG_COLUMN=searched
# PROCESSED_AT_COLUMN=processed_at
#
# 如需覆盖默认值，取消下面的注释并修改：
# DB_DIALECT=sqlite
# RAIN_EVENTS_TABLE=rain_event
# EVENT_TIME_COLUMN=date
# LOCATION_COLUMN=city
# RAINFALL_COLUMN=value
# PROCESSED_FLAG_COLUMN=searched

# ---------------------- 任务调度配置 ----------------------
POLL_INTERVAL_SECONDS=300
BATCH_LIMIT=20
MIN_RAINFALL_MM=50.0
MAX_EVENT_LOOKBACK_HOURS=48

# ---------------------- 搜索时间窗口配置 --------------------
# 新闻搜索时间窗口（天），从事件当天开始向后搜索的天数
# 建议值：3-7天（考虑新闻时效性）
# 所有支持时间过滤的API（The News API、YouTube）都会使用这个配置
NEWS_SEARCH_WINDOW_DAYS=3

# ---------------------- 预过滤配置 --------------------
# 是否启用预过滤（在交给LLM前进行简单规则判断）
# 启用后可以减少token消耗，提高准确性
# 预过滤会检查：时间匹配、地点匹配、关键词匹配
PRE_FILTER_ENABLED=true

# 预过滤模式：strict（严格，必须同时满足时间+地点+关键词）或 loose（宽松，满足任意一个）
# strict: 只保留高度相关的结果，减少token消耗（推荐）
# loose: 保留更多结果，可能包含一些不相关结果
PRE_FILTER_MODE=strict

# 预过滤时间窗口（天），只保留事件时间 + N 天内的结果（不包括事件之前的内容）
PRE_FILTER_TIME_WINDOW_DAYS=3

# 预过滤后交给LLM验证的最大新闻数量（建议5-15，避免token超限）
# 如果预过滤后有更多结果，会取前N条交给LLM处理
# 设置太小可能遗漏重要信息，设置太大可能导致token超限
MAX_ITEMS_FOR_LLM_VALIDATION=10

# LLM验证时间窗口（天），用于判断搜索结果是否属于该事件（事件时间 + N 天）
# 默认值：5天（从原来的 ±3天 改为 +5天）
# 这个配置会影响LLM在验证和筛选时的判断标准
LLM_VALIDATION_TIME_WINDOW_DAYS=5

# ---------------------- 搜索 API 配置（必需） ---------------------
# Tavily API - 用于搜索政府、气象等官方网站
# 申请地址：https://www.tavily.com/
# 免费额度：约 100 次/天
TAVILY_API_KEY=your_tavily_api_key_here

# ========== 新闻 API 配置（多个可选，按需启用） ==========
# 在 search/query/channels.py 中通过 enabled 字段控制启用/禁用

# The News API - 推荐（支持历史数据）
# 申请地址：https://thenewsapi.com/
# 免费额度：每天 50 次请求，每次最多 50 条
# 优势：支持历史数据搜索（超过30天），覆盖 40,000+ 来源、50+ 国家、30+ 语言
# 默认启用
THENEWSAPI_KEY=your_thenewsapi_key_here

# GNews API - 可选（仅限30天内数据）
# 申请地址：https://gnews.io/
# 免费额度：每天 100 次请求，每次最多 10 条
# 限制：仅限开发/测试用途，不支持超过30天的历史数据
# 默认禁用，如需启用请在 channels.py 中设置 enabled=True
GNEWS_API_KEY=your_gnews_api_key_here

# SerpAPI - 可选（Google News 搜索）
# 申请地址：https://serpapi.com/
# 免费额度：100 次请求
# 限制：超额需付费
# 默认禁用，如需启用请在 channels.py 中设置 enabled=True
SERPAPI_KEY=your_serpapi_key_here

# YouTube Data API - 用于视频搜索
# 申请地址：https://console.cloud.google.com/
# 步骤：创建项目 -> 启用 YouTube Data API v3 -> 创建 API Key
# 免费额度：每天 10,000 单位
YOUTUBE_API_KEY=your_youtube_api_key_here

# ---------------------- 搜索 API 配置（可选） ---------------------
# ========== 社交媒体 API 配置（多个可选） ==========

# Instagram Graph API - 推荐（Meta 官方 API）
# 申请地址：https://developers.facebook.com/
# 步骤：
#   1. 访问 Facebook Developers
#   2. 创建应用（选择 Instagram 产品）
#   3. 申请 Instagram Basic Display API 或 Instagram Graph API
#   4. 完成 App 审核（可能需要数天到数周）
#   5. 获取 Access Token
# 费用：免费（但需 App 审核，商业用途可能需要企业验证）
# 限制：主要面向商业账户，需要用户授权或使用公开 hashtag/location
INSTAGRAM_ACCESS_TOKEN=your_instagram_access_token_here
INSTAGRAM_APP_ID=your_instagram_app_id_here
INSTAGRAM_APP_SECRET=your_instagram_app_secret_here

# X (Twitter) API - 付费方案
# 申请地址：https://developer.twitter.com/
# 费用：Basic 计划 $200/月（月付）或 $175/月（年付）
# 包含：每月读取 10,000 条推文、写入 3,000 条推文
# 如果暂时不使用，可以留空
X_BEARER_TOKEN=your_x_bearer_token_here

# SerpAPI（已弃用，保留兼容）
# SERPAPI_KEY=your_serpapi_key_here

# NewsAPI（备用）
# NEWSAPI_KEY=your_newsapi_key_here

# ---------------------- LLM 配置（必需） --------------------
# LLM 用于智能信息验证、提取和报告生成
# 支持 OpenAI 和 Google Gemini，二选一即可

# LLM 提供商选择：openai 或 gemini
LLM_PROVIDER=openai

# ========== OpenAI 配置（如果 LLM_PROVIDER=openai） ==========
# OpenAI API Key
# 申请地址：https://platform.openai.com/api-keys
# 推荐模型：gpt-4o-mini（便宜且快）或 gpt-4o（更强大）
# 成本：约 $0.003/次（gpt-4o-mini）
OPENAI_API_KEY=your_openai_api_key_here
# OpenAI Base URL（可选，支持自定义，如本地部署）
# OPENAI_BASE_URL=https://api.openai.com/v1
# OpenAI 模型名称
OPENAI_MODEL=gpt-4o-mini

# ========== Google Gemini 配置（如果 LLM_PROVIDER=gemini） ==========
# Gemini API Key
# 申请地址：https://makersuite.google.com/app/apikey
# 推荐模型：gemini-2.5-flash（免费额度大）或 gemini-2.5-pro（更强大）
# 成本：基本免费（免费额度内）
# 注意：需要使用新的 google-genai 库（pip install google-genai）
GEMINI_API_KEY=your_gemini_api_key_here
# Gemini 模型名称（推荐：gemini-2.5-flash）
GEMINI_MODEL=gemini-2.5-flash

# ========== 通用 LLM 配置 ==========
# LLM 温度（越低越确定，推荐 0.3）
LLM_TEMPERATURE=0.3
# 最大输出 token 数（Gemini 推荐 8000，避免截断）
LLM_MAX_TOKENS=8000
# LLM 请求超时时间（秒）
LLM_TIMEOUT=60

# ---------------------- LLM / 翻译配置（已弃用，保留兼容） --------------------
# 当前报告生成使用模板，暂不需要翻译 API
# 如需接入翻译服务，可配置以下项：
# TRANSLATOR_API_KEY=your_translator_api_key
# TRANSLATOR_BASE_URL=https://api.openai.com/v1
# TRANSLATOR_MODEL=gpt-4o-mini
# SUMMARIZER_API_KEY=your_summarizer_api_key
# SUMMARIZER_BASE_URL=https://api.openai.com/v1
# SUMMARIZER_MODEL=gpt-4o-mini

# ============================================
# 注意事项：
# 1. 所有 API Key 请妥善保管，不要泄露
# 2. 免费层 API 有调用限制，请合理使用
# 3. 生产环境建议使用环境变量而非 .env 文件
# 4. 确保 .env 文件已添加到 .gitignore
# ============================================

